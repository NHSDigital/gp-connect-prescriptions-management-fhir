# This is an OpenAPI Specification (https://swagger.io/specification/)
# for gp-connect-prescriptions-management-fhir owned by NHS Digital (https://digital.nhs.uk/)
openapi: '3.0.0'
info:
  title: 'GP Connect Prescriptions Management FHIR API'
  version: 'Computed and injected at build time by `scripts/set_version.py`'
  description: |
    ## Overview

    Use this API to manage a patient's prescriptions as held by their GP practice.
    
    You can:

    * request a new instance of a repeat prescription

    * view all of a patients medications, whether acute or repeat, past or present

    * cancel a repeat prescription request
    
    * check the status of a current prescription request

    * request a new instance of a repeat prescription to a one off nomination pharmacy

    The end user must be a patient who is: 

    *  registered with the GP practice 

    *  registered with NHS login to P9 identity verification level

    For example:

    * a patient can view their own medication, request a new instance of a repeat prescription and cancel that request
    
    ## Who can use this API

    This API can be used by developers of clinical systems that support clinicans delivering direct care. It is a patient-facing API.
    
    This API:

    * is intended only for use by patient-facing applications

    * is intended only for non-clinical use

    * can only be used where there is a legal basis to do so

    Make sure you have a valid use case before you go too far with development. To do this, contact us. 

    You must do this before you can go live (see Onboarding below).

    ### Prerequisites 

    #### Information governance (IG)
    
    You must:

    * be compliant with the GP Connect Direct Care API Information Governance Model

    #### Clinical safety 

    You must:

    * have a clinical safety officer (CSO) who is responsible for DCB0129 and, if necessary, DCB0160. For more on clinical risk management, visit Clinical risk management standards

    ## Related APIs
    
    * [Electronic Prescription Service - FHIR API](https://digital.nhs.uk/developer/api-catalogue/electronic-prescription-service-fhir) - use this API to issue requested prescriptions as electronic prescriptions.
    
    * [Electronic Prescription Service Tracker - REST API](https://digital.nhs.uk/developer/api-catalogue/spine-electronic-prescription-service-tracker-rest) - use this API to track the dispensing status of EPS prescriptions once they leave the GP system. 
    
    * [GP Connect (Patient Facing) User Permissions API](https://digital.nhs.uk/developer/api-catalogue/gp-connect-patient-facing-user-permissions) - use this API to manage a patient's permissions as held by the GP practice systems.

    * [GP Connect (Patient Facing) Appointment Management - FHIR API](https://digital.nhs.uk/developer/api-catalogue/gp-connect-patient-facing-appointment-management-fhir) - use this API to manage GP practice appointments.

    * [GP Connect (Patient Facing) Access Record - FHIR API](https://digital.nhs.uk/developer/api-catalogue/gp-connect-patient-facing-access-record-fhir) - use this API to manage a patient's medical record from the GP practice systems.

    * [GP Connect Access Record: Structured - FHIR API](https://digital.nhs.uk/developer/api-catalogue/gp-connect-access-record-structured-fhir) - use this API for clinical access to the record, including structured medications linked to other elements of the patient record.


    ## API status and roadmap
    
    This API is in [development](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#statuses)

    To see our roadmap or to suggest, comment or vote on features for this API, see our [interactive product backlog.](https://nhs-digital-api-management.featureupvote.com/suggestions/341619/gp-connect-prescriptions-management-fhir)

    If you have any other queries, [contact us](https://digital.nhs.uk/developer/help-and-support)

    ## Service level

    This API is a silver service, meaning it is operational 24 x 7 x 365 but only supported during business hours (8am to 6pm), Monday to Friday excluding bank holidays.
    
    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology

    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which are built against [FHIR UK Core, specifically [UKcore.stu1 0.5.1](https://simplifier.net/packages/fhir.r4.ukcore.stu1/0.5.1).

    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules. In particular:
    
    * resource names are capitalised and singular, for example `/Patient` not `/patients`
    
    * array names are singular, for example `line` not `lines` for address lines
    
    * data items that are country-specific and thus not included in the FHIR global base resources are usually wrapped in an `extension` object

    There are [libraries and software development kits available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access

    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).

    For more details, see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation

    This API is [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis), meaning an end user must be present and authenticated to use it. 

    The end user must be:

    * a patient

    * authenticated with NHS login to P9 identity verification level

    The API uses Open ID Connect to authenticate the end user and OAuth 2.0 to authorise the calling system. It supports the following security pattern using NHS login: 
    
    * [User-restricted RESTful APIs - NHS login separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-login-separate-authentication-and-authorisation)

    ## Environments and testing
    
    |Environment|Base URL|
    |-----------|--------|
    |Sandbox|`https://sandbox.api.service.nhs.uk/gp-connect/prescriptions/FHIR/R4`|
    |Integration Testing|`Not yet available`|
    |Production|`Not yet available`|

    ### Sandbox testing (Not yet available)

    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):

    * is for early developer testing

    * only covers a limited set of scenarios

    * is stateless, so it does not store data

    * is open access, so does not allow you to test authorisation

    For more details on sandbox testing, or to try out the sandbox using our "Try this API" feature, see the documentation for each endpoint.

    ### Integration testing (not yet available)
    
    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing):
    
    * is for formal integration testing
    
    * is stateful, so it does persist data
    
    * includes authorisation
    
    For more details see [integration testing with our RESTful APIs](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing-with-our-restful-apis).

    ## Onboarding

    We are hoping to make the assurance process as lightweight and as self-service as possible.

    ## Resources

    Use the [GP Connect Prescriptions Management Implementation Guide](https://simplifier.net/guide/GP-Connect-Prescription-Management-FHIR-PFS) to assist with your integration.

    This is the FHIR specification for GP Connect Prescriptions.

    ## Errors

    We use standard HTTP status codes to show whether an API request succeeded or not. They are usually in the range:

    - 200 to 299 if it succeeded, including code 202 if it was accepted by an API that needs to wait for further action

    - 400 to 499 if it failed because of a client error by your application

    - 500 to 599 if it failed because of an error on our server

    Errors specific to each API are shown in the Endpoints section, under Response. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#http-status-codes) for more on errors.

    API Specific errors can be found [here.](https://simplifier.net/guide/GP-Connect-Prescription-Management-FHIR-PFS/Home/Design/Errors-and-issues.page.md?version=current)
  contact:
    name: 'gp-connect-prescriptions-management-fhir API Support'
    url: 'https://digital.nhs.uk/developer/help-and-support'
    email: api.management@nhs.net
servers:
  - url: 'https://sandbox.api.service.nhs.uk/gp-connect/prescriptions/FHIR/R4'
    description: Sandbox environment.
  - url: 'https://int.api.service.nhs.uk/gp-connect/prescriptions/FHIR/R4'
    description: Integration test environment.
  - url: 'https://api.service.nhs.uk/gp-connect/prescriptions/FHIR/R4'
    description: Production environment.
x-spec-publication:
  operation-order:
    - operations:
        - method: GET
          path: /FHIR/R4/Task
        - method: PATCH
          path: /FHIR/R4/Task
        - method: POST
          path: /FHIR/R4/Task
        - method: GET
          path: /FHIR/R4/Patient/{id}/MedicationStatement/
        - method: GET
          path: /FHIR/R4/MedicationRequest/{identifier}
        - method: GET
          path: /FHIR/R4/Patient/{id}/MedicationRequest/
paths: 
  /FHIR/R4/Task/:
    get:
      operationId: get-task
      summary: Get requested prescription reorders
      description: >
        ## Overview
        
        Use this end point to check the status of your current prescription request.
        
        You must provide at least one of the following parameters:

        * id

        * patient

      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
        - in: query
          name: patient
          description: >
            The NHS number of the patient whose requests you are searching for
          required: false
          schema:
            type: string
            example: '9912003489'
        - in: query
          name: id
          description: >
            The id of the Task itself
          required: false
          schema:
            type: string
            example: 'dad85fcc-d3a0-4806-886a-a573bd48ad2c'
        - in: query
          name: status
          description: >
            The type of status to search: you can find valid values [here](https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/80166)
          required: false
          schema:
            type: string
            example: 'requested'
        - in: query
          name: authored-on
          description: >
            Date the prescription was requested, format: <eq|ge|le>YYYY-MM-DD. To use a range use authored-on=geYYYY-MM-DD&authored-on=leYYYY-MM-DD
          required: false
          schema:
            type: string
          examples:
            exact date:
              value:
                - eq2010-10-22
              description: Exact match date
            greater than or equals:
              value:
                - ge2022-01-15
              description: Greater than or equals which matches 2022-01-15 or 2022-01-16
            less than or equals:
              value: 
                -  le2022-01-15
              description: Less than or equals which matches 2022-01-15 or 2022-01-14
      responses:
        '200':
          description: Successful query
          content: 
            application/fhir+json:
              schema: 
                type: object
              examples:
                example:
                  description: Successful request to view requests for prescriptions
                  value: 
                    resourceType: Bundle
                    id: a96bb563-c86b-4021-903e-5917b927c386
                    identifier: 
                      system: "https://tools.ietf.org/html/rfc4122"
                      value: a3294018-6c63-4556-8797-f782d1c95480
                    type: searchset
                    entry:
                      - resource: 
                          resourceType: Task
                          id: aef77afb-7e3c-427a-8657-2c427f71a271
                          identifier: 
                          - system: "https://tools.ietf.org/html/rfc4122"
                            value: 725ca1bd-2860-4476-8802-8d035d802e7f                          
                          status: requested
                          intent: order
                          focus: 
                            reference: MedicationRequest/06c7d0e2-1022-4e47-ac55-f6463d701a4f
                          for: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'                            
                            display: Jane Smith
                          authoredOn: 2022-11-23T20:20:27+07:00
                          lastModified: 2022-11-23T20:20:27+07:00
                          requester: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'
                            display: Jane Smith
                          note:
                            - authorString: Patient
                              text: 'Ran out of previous prescription'
                      - resource:
                          resourceType: Task
                          id: fjugkd8281-4tngn-j4fn-8657-2knrkfjrgu
                          identifier:
                          - system: "https://tools.ietf.org/html/rfc4122"
                            value: 725ca1bd-2860-4476-8802-8d035d802e7f                                
                          status: rejected
                          statusReason:
                            text: No longer suitable, please contact GP to organise an appointment
                          intent: order
                          focus: 
                              reference: MedicationRequest/b269d1d7-1acf-47bb-8b3c-e38b583d9a07
                          for: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'                                     
                            display: Jane Smith
                          authoredOn: 2022-08-14T07:20:23+07:00
                          lastModified: 2022-08-14T11:40:47+07:00
                          requester: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'                            
                            display: Jane Smith
                      - resource:
                          resourceType: Task
                          id: 84722efb-95b0-4769-921a-eda53382b320
                          identifier:
                          - system: "https://tools.ietf.org/html/rfc4122"
                            value: 2270b136-7a4c-491e-8bf1-624b5c4f20b7                            
                          status: in-progress
                          intent: order
                          focus: 
                              reference: MedicationRequest/a0531933-0673-45d4-bcb9-80acfd8a9fc7
                          for: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'                            
                            display: Jane Smith
                          authoredOn: 2022-10-13T16:20:27+07:00
                          lastModified: 2022-10-15T11:28:13+07:00
                          requester: 
                            reference: Patient/9000000009
                            identifier: 
                              system: https://fhir.nhs.uk/Id/nhs-number
                              value: '9000000009'                            
                            display: Jane Smith
    post:
      operationId: post-task
      summary: Request a repeat prescription 
      description: >
        ## Overview 

        Use this end point to create a request for a repeat prescription or repeat dispensing prescription. The same end point can be used to request a prescription to a one off pharmacy nomination - the ODS code is set in MedicationRequest.dispenseRequest.performer. 

        For this, send a task with a focus of the MedicationRequest. The MedicationRequest should be contained within the Task resource.

      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
      requestBody:
        required: true
        description: Successful Request.
        content: 
          application/fhir+json:
            schema:
              type: object
              description: >
                Example of a valid Task, with focus on MedicationRequest 
            example:
                resourceType: Task
                id: 7c747c6e-15c8-4b2f-8aa0-441f2ef703d6
                identifier: 
                - system: "https://tools.ietf.org/html/rfc4122"
                  value: 30d65c8e-98e8-4806-b6a6-fpwjfkhs729
                status: requested
                intent: order
                code: 
                   coding:
                    - system: "http://snomed.info/sct"
                      code: '103742009'
                      display: Renewal of prescription
                focus: 
                    reference: "MedicationRequest/b269d1d7-1acf-47bb-8b3c-e38b583d9a07"
                for: 
                  reference: Patient/9000000009
                  identifier: 
                    system: https://fhir.nhs.uk/Id/nhs-number
                    value: '9000000009'
                  display: Jane Smith
                authoredOn: 2022-10-13T09:20:27.000Z
                lastModified: 2022-10-13T09:20:27.000Z
                requester: 
                  reference: Patient/9000000009
                  identifier: 
                    system: https://fhir.nhs.uk/Id/nhs-number
                    value: '9000000009'
                  display: Jane Smith
                note: 
                  - authorString: Patient
                    text: ran out of previous prescription
                input:
                  - type:
                      coding:
                      - system: "https://fhir.hl7.org.uk/GPConnect-PrescriptionOrderingParameters"
                        code: preferred-performer
                        display: Preferred performer
                    valueIdentifier:
                      system: "https://fhir.nhs.uk/Id/ods-organization-code"
                      value: FLM49

      responses:
        '201':
          description: Successfully submitted.         
    patch:
      operationId: cancel-jsonpatch
      summary: Cancel an unactioned repeat prescription request
      description: >
        ## Overview 
        
        Use this endpoint to cancel a current request that has not been actioned yet.

        The content-type for this request must be "application/json-patch+json".
        
        The request must include the following parameter:

        * identifier

      parameters:
        - in: header
          name: content-type
          description: >
            The content-type of the request. 
          required: true
          schema: 
            type: string
            example: application/json-patch+json
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
        - in: query
          name: identifier
          description: >
            The identifier of the Task to cancel
          required: true
          schema:
            type: string
            example: 'aef77afb-7e3c-427a-8657-2c427f71a271'
      requestBody:
        required: true
        description: Successful Request.
        content: 
          application/json-patch+json:
            schema:
              type: object
              description: >
                JSON patch for cancellation
            examples:
              jsonpatch:
                description: |
                  A valid JSON patch for cancelling the status
                value:
                  - op: replace
                    path: "/status"
                    value: cancelled
      responses:
        '200':
          description: Successful request to cancel a request
  /FHIR/R4/Patient/{id}/MedicationStatement:
    get:
      operationId: get-medicationstatement
      summary: Get medications relating to a patient
      description: >
        ## Overview
        
        This end point returns MedicationStatements relating to a patient, which show courses of medication prescribed to the patient. 

        These MedicationStatements must reference a MedicationRequest within the basedOn attribute: MedicationRequests provide details of specific prescriptions. The display within basedOn should quote the courseOfTherapyType from the referenced MedicationRequest, showing the prescription treatment type.

        The request must include the following parameter:

        * patient

      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
        - in: path
          name: id
          description: >
            The NHS number of the patient whose requests you are searching for
          required: true
          schema:
            type: string
            example: '9000000009'
        - in: query
          name: effective
          description: >
            The start date should be when the medication started in the episode of care. <eq|ge|le>yyyy-mm-dd. To use a range use authored-on=geyyyy-mm-dd&authored-on=leyyyy-mm-dd
          required: false
          schema:
            type: string
          examples:
            exact date:
              value:
                - eq2010-10-22
              description: Exact match date
            greater than or equals:
              value:
                - g2022-01-15
              description: Greater than or equals which matches 2022-01-15 or 2022-01-16
            less than or equals:
              value: 
                -  le2022-01-15
              description: Less than or equals which matches 2022-01-15 or 2022-01-14
      responses: 
        '200':
          description: Successful request to view medication
          content: 
            application/fhir+json:
              schema: 
                type: object
              examples:
                example:
                  description: Successful response to view medication
                  value:
                    resourceType: Bundle
                    id: ec6077a4-553f-4087-944c-ea04c4593e3a
                    identifier:
                      system: https://tools.ietf.org/html/rfc4122
                      value: 86af4f6c-30c5-4947-acc7-2f55145181de
                    type: searchset
                    entry:
                      - resource:
                          resourceType: MedicationStatement
                          id: 44f85d15-8744-47c2-a790-4f5e38aacdb0
                          identifier:
                            - system: "https://tools.ietf.org/html/rfc4122"
                              value: "123jkwndf-1234-dgdg-134dd-4f5e38aacdb0"
                          basedOn:
                            - reference: MedicationRequest/0ae6ac98-6b0f-404f-a95b-c38a4318f686
                              display: Repeat prescription request for Aspirin 300mg Dispersible tablets.
                          status: active
                          medicationCodeableConcept:
                            coding:
                              - system: https://dmd.nhs.uk
                                code: "329526003"
                                display: Aspirin 300mg dispersible tablets
                          subject:
                            reference: Patient/9000000009
                            display: Jane Smith
                          effectivePeriod:
                            start: '2022-10-23T13:50:00+00:00'
                            end: '2023-01-10T13:50:00+00:00'
                          dateAsserted: '2022-11-23T13:50:00+00:00'
                          dosage:
                            - text: 2 tablet - 4 times a day - at a meal - Dissolve or mix with water before taking - up to a maximum of 3.6 gram in 24 hours
                              additionalInstruction:
                                - coding:
                                    - system: http://snomed.info/sct
                                      code: '417995008'
                                      display: Dissolve or mix with water before taking
                              timing:
                                repeat:
                                  frequency: 4
                                  period: 1
                                  periodUnit: d
                                  when:
                                    - C
                              doseAndRate:
                                - doseQuantity:
                                    value: 2
                                    unit: tablet
                                    system: http://snomed.info/sct
                                    code: '428673006'
                      - resource:
                          resourceType: MedicationStatement
                          id: 4a3f265d-1c12-4aa1-9d22-49b7c5aa2048
                          identifier:
                            - system: https://tools.ietf.org/html/rfc4122
                              value: 504e8d5b-0444-41ae-b5b7-f6f161b2bbbc
                          basedOn:
                            - reference: MedicationRequest/0f450c33-67b2-4ca3-b0f9-fea75ccdcd44
                              display: Acute prescription request for Amoxicillin 250mg capsules.
                          status: active
                          medicationCodeableConcept:
                            coding:
                              - system: https://dmd.nhs.uk
                                code: '39732311000001104'
                                display: Amoxicillin 250mg capsules
                          subject:
                            reference: Patient/9000000009
                            display: Jane Smith
                          effectivePeriod:
                            start: '2022-10-23T13:50:00+00:00'
                            end: '2023-01-10T13:50:00+00:00'
                          dateAsserted: '2022-11-23T13:50:00+00:00'
                          dosage:
                            - text: 2 capsules 4 times a day.
                              timing:
                                repeat:
                                  frequency: 4
                                  period: 1
                                  periodUnit: d
                              asNeededCodeableConcept:
                                coding:
                                  - system: http://snomed.info/sct
                                    code: '301354004'
                                    display: Pain of ear
                              site:
                                coding:
                                  - system: http://snomed.info/sct
                                    code: '123851003'
                                    display: Mouth region structure
                              route:
                                coding:
                                  - system: http://snomed.info/sct
                                    code: '26643006'
                                    display: Oral route
                              method:
                                coding:
                                  - system: http://snomed.info/sct
                                    code: '421984009'
                                    display: Until finished
                              doseAndRate:
                                - doseQuantity:
                                    value: 500
                                    unit: milligram
                                    system: http://unitsofmeasure.org
                                    code: mg
  /FHIR/R4/MedicationRequest/{id}:
    get:
      operationId: get-planned-medicationrequest
      summary: Get a specific planned medication request
      description: > 
        Use this endpoint in order to get specific MedicationRequests 
        
        The request must include the following parameter:

        * id

      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
        - in: path
          name: id
          description: >
            The id of the MedicationRequest you are searching for
          required: true
          schema:
            type: string
            example: '0ae6ac98-6b0f-404f-a95b-c38a4318f686'
      responses:
        '200':
          description: Successful request to view current and previous prescription details
          content: 
            application/fhir+json:
              schema: 
                type: object
              examples:
                example:
                  value:
                    resourceType: MedicationRequest
                    id: b269d1d7-1acf-47bb-8b3c-e38b583d9a07
                    identifier: 
                      - system: "https://fhir.nhs.uk/Id/prescription-order-number"
                        value: CDT38E-Y765968-4FG3BQ
                    status: active
                    intent: order
                    category: 
                      - coding: 
                        - system: "http://terminology.hl7.or/CodeSystem/medicationrequest-category"
                          code: community
                          display: Community
                    medicationCodeableConcept:
                      coding: 
                        - system: "http://snomed.info/ct"
                          code: '3113111000001106'
                          display: Pulmicort 100 Turbohaler (AstraZeneca UK Ltd)
                    subject:
                      reference: Patient/9000000009
                      display: Jane Smith
                    requester:
                      reference: Patient/9000000009
                      display: Jane Smith
                    courseOfTherapyType:
                      coding:
                        - system: "https://fhir.hl7.org.uk/CodeSystem/UKCore-MedicationRequestCourseOfTherapy"
                          code: continuous
                          display: Continuous long term therapy
                    authoredOn: 2022-10-13T16:20:27+07:00
                    substitution:
                      allowedBoolean: false
                    dosageInstruction: 
                    - text: One to two puffs to be inhaled as needed
                      method:
                          coding: 
                          - system: "http://snomed.info/sct"
                            code: '420652005'
                            display: Until Gone        
  /FHIR/R4/Patient/{id}/MedicationRequest/:
    get:
      operationId: get-ordered-medicationrequest
      summary: Get prescription issue details
      description: > 
        Use this endpoint in order to get details of previous prescription issues.

        The request must include the following parameter:
        
        * patient
        
        The request can optionally include include one of following parameters:

        * authoredon

      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/RequestID" 
        - in: path
          name: id
          description: >
            The NHS number of the patient whose requests you are searching for
          required: true
          schema:
            type: string
            example: '9912003489'
        - in: query
          name: authoredon
          description: >
            Date the prescription was requested, format: <eq|ge|le>YYYY-MM-DD. To use a range use authored-on=geYYYY-MM-DD&authored-on=leYYYY-MM-DD
          required: false
          schema:
            type: string
          examples:
            exact date:
              value:
                - eq2010-10-22
              description: Exact match date
            greater than or equals:
              value:
                - ge2022-01-15
              description: Greater than or equals which matches 2022-01-15 or 2022-01-16
            less than or equals:
              value: 
                -  le2022-01-15
              description: Less than or equals which matches 2022-01-15 or 2022-01-14
        - in: query
          name: identifier
          description: >
            EPS prescription Identifier for the prescription. Searches for EPS prescriptions need to provide a data type of `https://fhir.nhs.uk/Id/prescription-order-number` in the format `<data-type>|<prescription-identifier>`
          required: false
          schema:
            type: string
          examples:
            eps-prescription:
              value:
                - "https://fhir.nhs.uk/Id/prescription-order-number|CDT38E-Y765968-4FG3BQ"
      responses:
        '200':
          description: Successful request to view previous prescription issue details
          content: 
            application/fhir+json:
              schema: 
                type: object
              examples:
                example:
                  value:
                    resourceType: Bundle
                    id: 2b62ff26-25a9-4a88-8cb6-f69e85fb6159
                    identifier: 
                      system: "https://tools.ietf.org/html/rfc4122"
                      value: 86af4f6c-30c5-4947-acc7-2f55145181de
                    type: searchset
                    entry:
                      - resource: 
                          resourceType: MedicationRequest
                          id: b269d1d7-1acf-47bb-8b3c-e38b583d9a07
                          identifier: 
                            - system: "https://fhir.nhs.uk/Id/prescription-order-number"
                              value: CDT38E-Y765968-4FG3BQ
                          status: active
                          intent: order
                          category: 
                            - coding: 
                              - system: "http://terminology.hl7.or/CodeSystem/medicationrequest-category"
                                code: community
                                display: Community
                          medicationCodeableConcept:
                            coding: 
                              - system: "http://snomed.info/ct"
                                code: '3113111000001106'
                                display: Pulmicort 100 Turbohaler (AstraZeneca UK Ltd)
                          subject:
                            reference: Patient/9000000009
                            display: Jane Smith
                          requester:
                            reference: Patient/9000000009
                            display: Jane Smith
                          courseOfTherapyType:
                            coding:
                              - system: "https://fhir.hl7.org.uk/CodeSystem/UKCore-MedicationRequestCourseOfTherapy"
                                code: continuous
                                display: Continuous long term therapy
                          authoredOn: 2022-10-13T16:20:27+07:00
                          substitution:
                            allowedBoolean: false
                          dosageInstruction: 
                          - text: One to two puffs to be inhaled as needed
                            method:
                               coding: 
                                - system: "http://snomed.info/sct"
                                  code: '420652005'
                                  display: Until Gone
                      - resource: 
                          resourceType: MedicationRequest
                          id: 159757f8-6409-4b8c-b0df-f8feefc3ad0e
                          identifier: 
                            - system: "https://fhir.nhs.uk/Id/prescription-order-number"
                              value: CDT38E-Y765968-1650B+
                          status: active
                          intent: order
                          category: 
                            - coding: 
                              - system: "http://terminology.hl7.or/CodeSystem/medicationrequest-category"
                                code: community
                                display: Community
                          medicationCodeableConcept:
                            coding: 
                              - system: "http://snomed.info/ct"
                                code: '3113111000001106'
                                display: Pulmicort 100 Turbohaler (AstraZeneca UK Ltd)
                          subject:
                            reference: Patient/9000000009
                            display: Jane Smith
                          requester:
                            reference: Patient/9000000009
                            display: Jane Smith
                          courseOfTherapyType:
                            coding:
                              - system: "https://fhir.hl7.org.uk/CodeSystem/UKCore-MedicationRequestCourseOfTherapy"
                                code: continuous
                                display: Continuous long term therapy
                          authoredOn: 2022-11-13T14:20:27+07:00
                          substitution:
                            allowedBoolean: false
                          dosageInstruction: 
                          - text: One to two puffs to be inhaled as needed
                            method:
                               coding: 
                                - system: "http://snomed.info/sct"
                                  code: '420652005'
                                  display: Until Gone
components:
  parameters:
    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).
        Required in all environments except sandbox.
      required: true
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: 'Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM'
    RoleId:
      in: header
      name: NHSD-Session-URID
      description: |
        The user role ID (URID) for the current session. Also known as a user role profile ID (URPID).
        If you are using User-restricted RESTful APIs - NHS login separate authentication and authorisation, see [determine the user's role](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation#step-9-determine-the-user-s-role) for guidance.
        This field is optional.
      required: false
      schema:
        type: string
        pattern: '^[0-9]+$'
        example: '555254240100'
    CorrelationID:
      in: header
      name: X-Correlation-ID
      required: false
      description: |
        An optional ID which you can use to track transactions across multiple systems. It can have any value, but we recommend avoiding `.` characters.
        Mirrored back in a response header.
      schema:
        type: string
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
    RequestID:
      in: header
      name: X-Request-ID
      required: true
      description: |
        A globally unique identifier (GUID) for the request, which we use to de-duplicate repeated requests and to trace the request if you contact our helpdesk.
        Must be a universally unique identifier (UUID) (ideally version 4).
        
        Mirrored back in a response header.
        
        If you re-send a failed request, use the same value in this header.
        
        Required in all environments except sandbox.
      schema:
        type: string
        pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
     
